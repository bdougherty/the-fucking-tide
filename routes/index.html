<svelte:head>
	<title>The Fucking Tide</title>
</svelte:head>

{#if $findingLocation}
	<LoadingMessage>Finding your fucking location</LoadingMessage>
{:elseif $locationError}
	<Search on:search="$geocode(event.searchText)" />
{:elseif $fetchingPredictions}
	<LoadingMessage>Checking the fucking tide</LoadingMessage>
{:elseif $stationDistance > 30}
	<ErrorMessage title="Uhh, there aren’t any tides near you.">Go somewhere closer to some fucking tidal water {distanceEmoji($stationDistance)}.</ErrorMessage>
{:elseif $predictionError}
	<ErrorMessage title="We fucked up" error={$predictionError}>Check back later.</ErrorMessage>
{:else}
	<TideMessage station={$stationName} progress={$tideProgress} nextTide={$nextTide} />
{/if}

<script>
	import LoadingMessage from '../components/LoadingMessage.html';
	import ErrorMessage from '../components/ErrorMessage.html';
	import TideMessage from '../components/TideMessage.html';
	import Search from '../components/Search.html';

	export default {
		components: {
			LoadingMessage,
			ErrorMessage,
			TideMessage,
			Search
		},
		oncreate() {
			const { location } = this.store.get();

			if (!location) {
				this.store.getGeolocation();
			}
		},
		helpers: {
			distanceEmoji(distance) {
				if (distance < 500) {
					const emojis = [
						'🚗',
						'🚙'
					];

					return emojis[Math.floor(Math.random() * emojis.length)];
				}

				return '✈️';
			}
		}
	};
</script>
